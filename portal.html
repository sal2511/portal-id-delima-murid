<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Carian ID Delima - SK Kampong Chegar</title>
  <meta name="description" content="Portal carian ID Delima untuk pelajar SK Kampong Chegar">
  <meta property="og:title" content="Portal Carian ID Delima - SK Kampong Chegar">
  <meta property="og:description" content="Cari ID Delima pelajar dengan mudah">
  <meta property="og:type" content="website">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .header-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 15px;
            border-radius: 10px;
        }

        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            line-height: 1.3;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.95rem;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            border: 1px solid #feb2b2;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .student-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .student-info {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
            display: inline-block;
            min-width: 100px;
        }

        .info-value {
            color: #2d3748;
            font-weight: 500;
        }

        .footer {
            margin-top: auto;
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .header-image {
                width: 70px;
                height: 70px;
            }
            
            .search-section, .header, .result-card {
                padding: 20px;
            }
            
            .student-name {
                font-size: 1.2rem;
            }
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <header class="header"><img src="https://i.postimg.cc/mDS4G8yG/LOGO-SEKOLAH.jpg" alt="Logo SK Kampong Chegar" class="header-image" onerror="this.style.display='none';">
    <h1>Portal Carian ID Delima<br>
     [SK KAMPONG CHEGAR]</h1>
   </header>
   <main class="search-section">
    <form id="searchForm">
     <div class="input-group"><label for="mykadInput">No. MyKad Pelajar:</label> <input type="text" id="mykadInput" placeholder="Contoh: 123456789012" maxlength="12">
     </div><button type="submit" class="search-btn" id="searchBtn"> Cari ID </button>
    </form>
    <div id="loadingDiv" class="loading" style="display: none;">
     <div class="spinner"></div>
     <p>Mencari data...</p>
    </div>
    <div id="errorDiv" class="error-message" style="display: none;"></div>
    <div id="resultDiv"></div>
   </main>
   <footer class="footer">
    Â© Unit ICT [SK KAMPONG CHEGAR] 2025
   </footer>
  </div>
  <script>
        let csvData = [];
        let dataLoaded = false;

        // Load CSV data on page load
        async function loadCSVData() {
            try {
                console.log('Loading CSV data...');
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQgfwkCuG_ypvhTKdVWTo4SrVko4Jv3mi30CIPWfKIS9dRwHniEJyOE7PTU2D2nultkz7FAuHZuI_V_/pub?output=csv');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log('CSV text received, length:', csvText.length);
                console.log('First 200 characters:', csvText.substring(0, 200));
                
                csvData = parseCSV(csvText);
                dataLoaded = true;
                
                if (csvData.length === 0) {
                    showError('Tiada data ditemui dalam fail CSV.');
                } else {
                    console.log('Data loaded successfully:', csvData.length, 'records');
                    // Show a temporary success message
                    const successDiv = document.createElement('div');
                    successDiv.style.cssText = 'background: #c6f6d5; color: #22543d; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center; font-weight: 600;';
                    successDiv.textContent = `Data berjaya dimuat: ${csvData.length} rekod pelajar`;
                    document.querySelector('.search-section').appendChild(successDiv);
                    setTimeout(() => successDiv.remove(), 3000);
                }
            } catch (error) {
                console.error('Error loading CSV data:', error);
                showError('Ralat memuat data dari server. Sila semak sambungan internet dan cuba lagi.');
                dataLoaded = false;
            }
        }

        // Parse CSV text into array of objects
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) {
                console.error('CSV data is empty or invalid');
                return [];
            }
            
            // Handle different CSV formats and quoted values
            const parseCSVLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            };

            const headers = parseCSVLine(lines[0]).map(header => 
                header.toLowerCase().replace(/['"]/g, '').trim()
            );
            
            console.log('CSV Headers found:', headers);
            
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length > 0) {
                        const row = {};
                        headers.forEach((header, index) => {
                            row[header] = values[index] ? values[index].replace(/['"]/g, '').trim() : '';
                        });
                        data.push(row);
                    }
                }
            }
            
            console.log('Parsed CSV data:', data.length, 'records');
            console.log('Sample record:', data[0]);
            return data;
        }

        // Search function
        function searchStudent(mykad) {
            if (!dataLoaded) {
                showError('Data masih dimuat. Sila tunggu sebentar.');
                return null;
            }

            if (csvData.length === 0) {
                showError('Tiada data tersedia. Sila cuba lagi kemudian.');
                return null;
            }

            // Clean the input - remove any spaces or dashes
            const cleanMykad = mykad.replace(/[\s-]/g, '');
            
            console.log('Searching for MyKad:', cleanMykad);
            
            // Try different possible field names for MyKad
            const possibleMykadFields = ['mykad', 'no. mykad', 'no mykad', 'ic', 'nric'];
            
            // Find student by MyKad number
            const student = csvData.find(row => {
                for (let field of possibleMykadFields) {
                    const rowMykad = (row[field] || '').toString().replace(/[\s-]/g, '');
                    if (rowMykad === cleanMykad) {
                        console.log('Found student:', row);
                        return true;
                    }
                }
                return false;
            });

            if (!student) {
                console.log('No student found for MyKad:', cleanMykad);
                console.log('Available data sample:', csvData[0]);
            }

            return student;
        }

        // Display search result
        function displayResult(student) {
            const resultDiv = document.getElementById('resultDiv');
            
            if (!student) {
                showError('No. MyKad tidak ditemui. Sila semak dan cuba lagi.');
                return;
            }

            // Get student data with fallback field names
            const nama = (student.nama || student.name || '').toUpperCase();
            const kelas = student.kelas || student.class || '';
            const idDelima = student.id_delima || student['id delima'] || student.id || '';
            const kataLaluan = student['kata laluan'] || student.password || student.kata_laluan || student.katalaluan || '';

            resultDiv.innerHTML = `
                <div class="result-card">
                    <div class="student-name">${nama}</div>
                    <div class="student-info">
                        <span class="info-label">Kelas:</span>
                        <span class="info-value">${kelas}</span>
                    </div>
                    <div class="student-info">
                        <span class="info-label">ID Delima:</span>
                        <span class="info-value">${idDelima}</span>
                    </div>
                    <div class="student-info">
                        <span class="info-label">Kata Laluan:</span>
                        <span class="info-value">${kataLaluan}</span>
                    </div>
                </div>
            `;
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorDiv');
            const resultDiv = document.getElementById('resultDiv');
            
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            resultDiv.innerHTML = '';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Show loading state
        function showLoading(show) {
            const loadingDiv = document.getElementById('loadingDiv');
            const searchBtn = document.getElementById('searchBtn');
            
            loadingDiv.style.display = show ? 'block' : 'none';
            searchBtn.disabled = show;
        }

        // Handle form submission
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const mykadInput = document.getElementById('mykadInput');
            const mykad = mykadInput.value.trim();
            
            // Clear previous results and errors
            document.getElementById('errorDiv').style.display = 'none';
            document.getElementById('resultDiv').innerHTML = '';
            
            // Validate input
            if (!mykad) {
                showError('Sila masukkan No. MyKad.');
                return;
            }

            if (mykad.length < 12) {
                showError('No. MyKad mestilah 12 digit.');
                return;
            }

            // Show loading and search
            showLoading(true);
            
            setTimeout(() => {
                const student = searchStudent(mykad);
                displayResult(student);
                showLoading(false);
            }, 500);
        });

        // Load data when page loads
        window.addEventListener('load', loadCSVData);

        // Initialize Element SDK
        if (window.elementSdk) {
            const defaultConfig = {
                portal_title: "Portal Carian ID Delima [SK KAMPONG CHEGAR]",
                search_label: "No. MyKad Pelajar:",
                search_button: "Cari ID",
                footer_text: "Â© Unit ICT [SK KAMPONG CHEGAR] 2025"
            };

            window.elementSdk.init({
                defaultConfig,
                onConfigChange: async (config) => {
                    document.querySelector('.header h1').innerHTML = config.portal_title || defaultConfig.portal_title;
                    document.querySelector('label[for="mykadInput"]').textContent = config.search_label || defaultConfig.search_label;
                    document.getElementById('searchBtn').textContent = config.search_button || defaultConfig.search_button;
                    document.querySelector('.footer').textContent = config.footer_text || defaultConfig.footer_text;
                },
                mapToCapabilities: () => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["portal_title", config.portal_title || defaultConfig.portal_title],
                    ["search_label", config.search_label || defaultConfig.search_label],
                    ["search_button", config.search_button || defaultConfig.search_button],
                    ["footer_text", config.footer_text || defaultConfig.footer_text]
                ])
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99618d94667214eb',t:'MTc2MTcyOTE2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>